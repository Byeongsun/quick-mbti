<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>questions_bank.json 경로 점검</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; line-height:1.5; padding:16px }
    pre { background:#f7f7f9; border:1px solid #e5e7eb; padding:12px; border-radius:8px; white-space:pre-wrap }
    .ok { color:#0a7a31 } .fail{ color:#b91c1c } code{ background:#f1f5f9; padding:2px 4px; border-radius:4px }
  </style>
</head>
<body>
  <h1>questions_bank.json 경로 점검</h1>
  <div id="env"></div>
  <h2>시도 결과</h2>
  <div id="out"></div>

<script>
(function(){
  const out = document.getElementById('out');
  const env = document.getElementById('env');
  const ts = Date.now();

  // 현재 페이지 기준 repo 루트 추정 (/quick-mbti/)
  const { origin, pathname } = location;
  const seg = pathname.split('/').filter(Boolean);           // ["quick-mbti","test.html"]
  const repoRoot = seg.length ? `/${seg[0]}/` : '/';         // "/quick-mbti/"

  env.innerHTML = `<pre>
origin:        ${origin}
pathname:      ${pathname}
repoRoot 추정:  ${repoRoot}
</pre>`;

  const candidates = [
    `./questions_bank.json?ts=${ts}`,                        // 같은 폴더
    `questions_bank.json?ts=${ts}`,                          // 같은 폴더 (상대)
    `${repoRoot}questions_bank.json?ts=${ts}`,               // 루트 바로 아래
    `${repoRoot}data/questions_bank.json?ts=${ts}`,          // /data 폴더 아래
    `./data/questions_bank.json?ts=${ts}`,                   // 같은 폴더의 /data
    `${repoRoot}docs/questions_bank.json?ts=${ts}`,          // /docs 바로 아래
    `${repoRoot}docs/data/questions_bank.json?ts=${ts}`      // /docs/data 아래
  ];

  async function tryFetch(url) {
    const wrap = document.createElement('div');
    wrap.innerHTML = `<h3><code>${url}</code></h3><pre>요청 중...</pre>`;
    out.appendChild(wrap);

    try {
      const res = await fetch(url, { cache:'no-store', mode:'same-origin' });
      const info = [];
      info.push(`status: ${res.status}`);
      info.push(`finalURL: ${res.url}`);

      let text = '';
      try {
        text = await res.text();
      } catch(e) {
        info.push(`read error: ${e}`);
      }

      if (res.ok) {
        // JSON 파싱 확인
        try {
          const json = JSON.parse(text);
          info.push('JSON parse: OK');
          info.push('키 목록: ' + Object.keys(json).join(', '));
        } catch(e) {
          info.push('JSON parse: FAIL → ' + e);
          info.push('본문 일부: ' + text.slice(0, 200));
        }
        wrap.querySelector('pre').classList.add('ok');
      } else {
        wrap.querySelector('pre').classList.add('fail');
        info.push('본문 일부: ' + text.slice(0, 200));
      }

      wrap.querySelector('pre').textContent = info.join('\n');
    } catch (e) {
      wrap.querySelector('pre').classList.add('fail');
      wrap.querySelector('pre').textContent = 'fetch error: ' + e;
    }
  }

  candidates.forEach(tryFetch);
})();
</script>
</body>
</html>
